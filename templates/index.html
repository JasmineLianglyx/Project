<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Loan Prediction Explanation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Include Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Loan Prediction</h1>
    
    <!-- Data Instance Display Section -->
    <div class="section data-instance" id="data-instance">
        <h2>Current Loan Application Data</h2>
        <table id="data-table">
            <tr>
                <th>Gender</th>
                <th>Married</th>
                <th>Dependents</th>
                <th>Education</th>
                <th>Self Employed</th>
                <th>Applicant Income</th>
                <th>Coapplicant Income</th>
                <th>Loan Amount</th>
                <th>Loan Amount Term</th>
                <th>Credit History</th>
                <th>Property Area</th>
            </tr>
            <tr>
                <td id="gender-value"></td>
                <td id="married-value"></td>
                <td id="dependents-value"></td>
                <td id="education-value"></td>
                <td id="self-employed-value"></td>
                <td id="applicant-income-value"></td>
                <td id="coapplicant-income-value"></td>
                <td id="loan-amount-value"></td>
                <td id="loan-amount-term-value"></td>
                <td id="credit-history-value"></td>
                <td id="property-area-value"></td>
            </tr>
            <tr>
                <td colspan="11" id="value-row">
                    <!-- Values will be populated here -->
                </td>
            </tr>
        </table>
    </div>
    <div id="accuracy" class="section">
        <h2>Model Accuracy</h2>
        <div id="accuracy-result" style="font-size: 1.2rem; font-weight: bold; color: #333;"></div>
    </div>

    <div id="prediction" class="section">
        <h2>Prediction</h2>
        <div id="prediction-result" style="font-size: 1.2rem; font-weight: bold; color: #333;"></div>
    </div>
    
    <div id="shap" class="section">
        <h2>Feature Importance Overview</h2>
        <div class="explanation">
            <p>In this section, you'll find a visual representation of how each feature contributes to the loan prediction. The chart displays SHAP values, indicating the impact of each feature on the model's decision. Positive alues suggest a greater likelihood of loan approval, while negative values indicate a lesser likelihood.</p>
        </div>
        <canvas id="shap-bar" class="shap-bar"></canvas>
    </div>

    <div id="counterfactual" class="section">
        <h2>What-If Analysis</h2>
        <div class="explanation">
            <p>This section allows you to explore how changes in input features could alter the prediction result. Here, you'll see the minimum changes required for features to shift the prediction from its current outcome.</p>
        </div>
        <div id="counterfactual-content" style="font-size: 1rem; color: #333;"></div>
    </div>

    
    <div class="section">
        <h2>Interactive Panel</h2>
        <div class="explanation">
            <p>In this panel, you can modify the input features related to the loan application. Use the sliders and dropdown menus to adjust values such as income, gender, property area, and so on. After making changes, click the "Get New Prediction" button to see how your adjustments impact the loan prediction.</p>
        </div>
        <div id="controls"></div>
    </div>
    
    <div class="section button-container">
        <button id="predict-button" onclick="updatePrediction()">Get New Prediction</button>
        <button id="next-button" onclick="nextData()">Next</button>
    </div>

    <script>
        const e1Url = "{{ url_for('serve_e1') }}"; // Define the URL here
    </script>
    <script src="{{ url_for('static', filename='scripts.js') }}"></script>


</body>
</html>
